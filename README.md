# REEVO_xyz

# ReEvo: 基于多槽位策略池的代码进化优化框架技术说明

## 1. 初始化阶段
* **提示词**：启动 10 份相同的初始化请求，提示词为 `prompt0_init_generation.txt` 和代码框架 `code_bone.txt`。
* **快速验证**：
    * LLM 返回包含 A、B、C 三个部分的代码片段（A_LLM, B_LLM, C_LLM）。
    * **验证**：将新生成的片段（如 A_LLM）与fbkde的代码（如 B_fbkde, C_fbkde）组合。通过快速测评且执行成功的片段将被添加到对应的策略池中，否则直接丢弃（快速测评的得分不会更新至对应策略池）。
* **初始种群构建**：
    * 从验证通过的策略池中随机采样，组装生成 10 份完整的个体（A_rand + B_rand + C_rand）。
    * **分数更新**：对这 10 个个体进行正式测评，并更新各策略节点的平均分：
      *注：暂时认为代码分数是每个策略的得分，这儿后续可以再优化一下处理逻辑？？*


## 2. 交叉
* **任务分配**：每轮迭代执行 8 次交叉请求。其中 Slot A 和 Slot C  2 次，Slot B  4 次。
* **父代选择逻辑**：
    * 从对应槽位的策略池中挑选两个平均分不相等的策略。
    * 将两个策略按照“better”与“worse”的顺序填入交叉提示词模板（如 `prompt1_crossover_slot_B.txt`）。
* **组合评估**：
    * **组合**：新生成的策略片段与另外两个槽位中的“1 个精英节点 + N 个随机节点”进行组合（暂时令N=1，由此得到4个代码）。
    * **处理**：每个新片段通过此方式生成 4 个完整个体进行并行评估，每次评估都会更新对应ABC策略的得分。

## 3. 变异
* **选择**：对 Slot A、Slot B 和 Slot C 当前策略池中表现最好的策略节点 分别执行一次变异。
* **提示词**：使用对应的变异模板（如 `prompt2_mutation_slot_A.txt`），并将精英代码及其当前分数填入模板。
* **处理**：变异生成的新策略同样采用“1 个精英节点 + N 个随机节点”进行组合，生成 4 个个体进行评估。


## 4. 种群维护
* **种群截断**：合并父代种群与所有新生成的子代个体，按 `obj` 得分排列，仅保留前 `pop_size` 个个体进入下一轮进化。
* **策略池修剪**：
    * 当A槽位策略数量达到 40 个时，删除表现差的一半节点（BC同理）。
    * **保护机制**：当前种群正在使用的策略 ID（Active IDs）及全局最优个体对应的策略受强制保护，不受修剪影响。
    * 注：全局最优：策略最优和完整的代码最优。此处指的是代码最优。策略最优针对mean，代码最优针对max score*
